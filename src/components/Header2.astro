---
import nav from "../data/nav.json";
---

<script is:inline>
  let dropdownButtons = document.getElementsByClassName("dropdownButton");
  let dropdownContents = document.getElementsByClassName("dropdownContent");

  function hideButton(dropdownButton) {
    if (dropdownButton.getAttribute("aria-expanded") === "true") {
      dropdownButton.setAttribute("aria-expanded", false);
    }
  }

  function hideContent(dropdownContent) {
    if (!dropdownContent.classList.contains("hidden")) {
      dropdownContent.classList.add("hidden");
    }
  }

  function myFunction(item) {
    let dropdownContentId = "dropdownContent-" + item;
    let dropdownButtonId = "dropdownButton-" + item;
    let dropdownContent = document.getElementById(dropdownContentId);
    let dropdownButton = document.getElementById(dropdownButtonId);

    for (let i = 0; i < dropdownButtons.length; i++) {
      if (!(dropdownButtons[i].id === dropdownButtonId)) {
        hideButton(dropdownButtons[i]);
      }
    }

    for (let i = 0; i < dropdownContents.length; i++) {
      if (!(dropdownContents[i].id === dropdownContentId)) {
        hideContent(dropdownContents[i]);
      }
    }

    dropdownContent.classList.toggle("hidden");

    if (dropdownButton.getAttribute("aria-expanded") === "true") {
      dropdownButton.setAttribute("aria-expanded", "false");
    } else {
      dropdownButton.setAttribute("aria-expanded", "true");
    }
  }

  window.onclick = function (event) {
    if (
      !(
        event.target.classList.contains("dropdownButton") ||
        event.target.classList.contains("dropdownContent") ||
        event.target.classList.contains("dropdownItem") ||
        event.target.classList.contains("dropdownA")
      )
    ) {
      for (let i = 0; i < dropdownContents.length; i++) {
        hideContent(dropdownContents[i]);
      }

      for (let i = 0; i < dropdownButtons.length; i++) {
        hideButton(dropdownButtons[i]);
      }
    }
  };
</script>

<main class="flex gap-10 p-10">
  {
    nav.header.map((navItem) => (
      <div>
        {navItem.children.length >= 1 ? (
          <div class="dropdown">
            <button
              id={`dropdownButton-${navItem.slug}`}
              class="dropdownButton p-3 font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 focus:font-bold focus:bg-gray-300 focus:text-gray-900"
              onclick={`myFunction("${navItem.slug}")`}
              aria-expanded="false"
            >
              {navItem.name} &#5167;
            </button>

            <div
              id={`dropdownContent-${navItem.slug}`}
              class="hidden p-3 bg-gray-300 border border-sky-500 dropdownContent absolute"
            >
              <div class="flex flex-col gap-1 p-1 bg-gray-200 border border-red-500 dropdownItem">
                {navItem.children.map((navItemChild) => (
                  <a
                    href={`/${navItemChild.slug}`}
                    class="text-base font-medium p-2 bg-gray-100 border border-green-500 dropdownA"
                  >
                    {navItemChild.name}
                  </a>
                ))}
              </div>
            </div>
          </div>
        ) : (
          <div>
            {navItem.slug ? (
              <a
                href={`/${navItem.slug}`}
                class="p-3 font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 active:font-bold active:bg-gray-300 active:text-gray-900"
              >
                {navItem.name}
              </a>
            ) : (
              <a
              href={ navItem.link } target="_blank"
                class="p-3 font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 active:font-bold active:bg-gray-300 active:text-gray-900"
              >
                {navItem.name} &#10532;
              </a>
            )}
          </div>
        )}
      </div>
    ))
  }
</main>
