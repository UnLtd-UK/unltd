---
const { parentItems, childrenItems, relationships } = Astro.props;
---

<script is:inline>
  function openTab(element) {
    let sections = document.querySelectorAll("section[data-tabs]");
    let buttons = document.querySelectorAll("button[data-tabs]");

    // hide sections
    for (let i = 0; i < sections.length; i++) {
      sections[i].className = "hidden";
      sections[i].setAttribute("data-tabs", "false");
    }

    // deactive buttons
    for (let i = 0; i < buttons.length; i++) {
      let activeStyle = buttons[i].dataset.tabs;
      buttons[i].classList.remove(activeStyle);
      buttons[i].setAttribute("aria-selected", "false");
    }

    // section
    // console.log(element.id)
    // let id = encodeURIComponent(element.id);
    console.log(element.id)
    let section = document.querySelector(`section[aria-labelledby=${element.id}]`);
    section.classList.remove("hidden");
    section.setAttribute("data-tabs", "true");

    // button
    element.setAttribute("aria-selected", "true");
    element.classList.add(element.dataset.tabs);
  }
</script>

<div class="mt-3 sm:mt-4">
  <!-- Mobile -->
  <!-- <div class="lg:hidden">
        <label for="current-tab" class="sr-only">Select a tab</label>
        <select id="current-tab" name="current-tab"
            class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm">
            { parentItems.map((parentItem) => (
            <option><button onclick={`openTab(event, '${parentItem.slug}')`}></button>{ parentItem.name }</option>
            ))}
        </select>
    </div> -->

  <!-- Desktop -->
  <div class="hidden lg:block">
    <nav class="-mb-px flex space-x-8 border-b border-gray-200">
      {
        parentItems.map((parentItem, parentItemIndex) => (
          <button
            id={`${parentItem.slug}`}
            type="button"
            data-tabs="text-violet-600"
            onclick={`openTab(this)`}
            class={`whitespace-nowrap pb-4 px-1 font-medium text-sm transition ease-in-out delay-50 duration-300 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 ${
              parentItemIndex === 0 && `text-violet-600`
            }`}
            aria-selected={parentItemIndex === 0 ? `true` : `false`}
          >
            {parentItem.name}
          </button>
        ))
      }
    </nav>
  </div>
</div>

<div class="pt-5">
  {
    parentItems.map((parentItem, parentItemIndex) => (
      <section
        class={!(parentItemIndex === 0) && `hidden`}
        aria-labelledby={`${parentItem.slug}`}
        role="tabpanel"
        data-tabs={parentItemIndex === 0 ? `true` : `false`}
      >
        <div class="flex flex-col flex-wrap lg:flex-row">
          {relationships.map((relationship) => {
            if (parentItem.id === relationship.category.id)
              return (
                <>
                  {childrenItems.map(
                    (topic) =>
                      topic.id === relationship.topic.id && (
                        <div class="p-4 text-sm border-2 border-violet-50 hover:border-violet-200 rounded-xl basis-1/4 transition ease-in-out delay-50 duration-300 bg-violet-50 hover:bg-violet-100 hover:-translate-y-1 hover:scale-100 flex flex-col gap-1">
                          <p class="font-bold text-black">{topic.name}</p>
                          <p class="text-gray-600">{topic.description}</p>
                        </div>
                      )
                  )}
                </>
              );
          })}
        </div>
      </section>
    ))
  }
</div>

<!-- border-b-2 border-violet-500 text-violet-600 -->
