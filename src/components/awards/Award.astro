---
interface Programme {
    icon: string;
    name: string;
    path: string;
    colour?: "amber" | "purple" | string;
}

interface ProgrammeService {
    name: string;
    icon: string;
    included?: boolean;
}

type GrantUsability = Record<string, boolean>;

interface AwardProps {
    name: string;
    description: string;
    grant: number;
    programme: Programme;
    grantUsability: GrantUsability;
    programmeServices: ProgrammeService[];
}

const {
    name,
    description,
    grant,
    programme,
    grantUsability,
    programmeServices,
} = Astro.props as AwardProps;

// Theme tokens to keep Tailwind class names declarative while reflecting programme colourways.
const colourThemes = {
    amber: {
        badgeBg: "bg-amber-50 dark:bg-amber-400/10",
        badgeText: "text-amber-800 dark:text-amber-500",
        badgeRing:
            "inset-ring inset-ring-amber-600/20 dark:inset-ring-amber-400/20",
        servicesBg: "bg-amber-50 dark:bg-amber-400/10",
        servicesText: "text-amber-800 dark:text-amber-500",
        servicesRing:
            "inset-ring inset-ring-amber-600/20 dark:inset-ring-amber-400/20",
        serviceItemText: "text-gray-600 dark:text-amber-500",
    },
    purple: {
        badgeBg: "bg-purple-50 dark:bg-purple-400/10",
        badgeText: "text-purple-800 dark:text-purple-300",
        badgeRing:
            "inset-ring inset-ring-purple-600/20 dark:inset-ring-purple-400/20",
        servicesBg: "bg-purple-50 dark:bg-purple-400/10",
        servicesText: "text-purple-800 dark:text-purple-300",
        servicesRing:
            "inset-ring inset-ring-purple-600/20 dark:inset-ring-purple-400/20",
        serviceItemText: "text-gray-600 dark:text-purple-300",
    },
} as const;

const theme =
    colourThemes[(programme?.colour as keyof typeof colourThemes) ?? "amber"] ??
    colourThemes.amber;

const grantFormatted = new Intl.NumberFormat("en-GB", {
    style: "currency",
    currency: "GBP",
    maximumFractionDigits: 0,
}).format(grant ?? 0);

const grantUsabilityEntries = Object.entries(grantUsability ?? {});
const services = programmeServices ?? [];

// Determine if this is a Starting Up award (lighter) or Scaling Up award (darker)
const isStartingUp = name.toLowerCase().includes("starting up");

// Card background and text classes based on award type
const cardBg = isStartingUp
    ? "bg-white dark:bg-slate-200"
    : "bg-white dark:bg-slate-800";
const cardRing = isStartingUp
    ? "ring-1 ring-black/5 dark:ring-slate-300"
    : "ring-1 ring-black/5 dark:ring-white/10";
const cardShadow = isStartingUp
    ? "shadow-2xl dark:shadow-lg"
    : "shadow-2xl dark:shadow-none";

// Text classes for Starting Up (dark text on light bg) vs Scaling Up (light text on dark bg)
const titleText = isStartingUp
    ? "text-violet-600 dark:text-violet-700"
    : "text-violet-600 dark:text-violet-400";
const descText = isStartingUp
    ? "text-gray-600 dark:text-gray-700"
    : "text-gray-600 dark:text-gray-300";
const labelText = isStartingUp
    ? "text-gray-600 dark:text-gray-600"
    : "text-gray-600 dark:text-gray-400";
const grantText = isStartingUp
    ? "text-violet-950 dark:text-violet-900"
    : "text-violet-950 dark:text-violet-200";
const headingText = isStartingUp
    ? "text-gray-950 dark:text-gray-900"
    : "text-gray-950 dark:text-white";
const listText = isStartingUp
    ? "text-gray-600 data-disabled:text-gray-400 dark:text-gray-700 dark:data-disabled:text-gray-400"
    : "text-gray-600 data-disabled:text-gray-400 dark:text-gray-300 dark:data-disabled:text-gray-500";
const dividerBorder = isStartingUp
    ? "border-gray-300 dark:border-gray-400"
    : "border-gray-300 dark:border-white/15";
---

<div
    class="-m-2 grid grid-cols-1 rounded-4xl bg-white/2.5 shadow-[inset_0_0_2px_1px_#ffffff4d] ring-1 ring-black/5 max-lg:mx-auto max-lg:w-full max-lg:max-w-md dark:shadow-[inset_0_0_2px_1px_#ffffff32]"
>
    <div
        class="grid grid-cols-1 rounded-4xl p-2 shadow-md shadow-black/5 dark:shadow-none"
    >
        <div class:list={["rounded-3xl", cardBg, cardShadow, cardRing]}>
            <div class="p-10 pb-0">
                <div class="flex flex-col gap-1">
                    <div>
                        <span
                            class="uppercase inline-flex items-center rounded-full bg-slate-50 px-1.5 py-0.5 text-xs font-medium text-slate-600 inset-ring inset-ring-slate-500/10 dark:bg-slate-400/10 dark:text-slate-400 dark:inset-ring-gray-400/20"
                        >
                            {name} +
                            {programme.code}
                        </span>
                    </div>
                    <div class:list={["text-sm", labelText]}>
                        <h2>{name} grant of up to</h2>
                    </div>
                    <div class:list={["text-5xl font-semibold", grantText]}>
                        {grantFormatted}
                    </div>
                </div>
                <div class="mt-8 flex flex-col gap-1">
                    <div class:list={["text-sm", labelText]}>
                        <p>Enrollment onto</p>
                    </div>
                    <!-- <div
                                    class="text-4xl font-semibold text-violet-950 dark:text-violet-200"
                                >
                                    12 months
                                </div> -->
                    <div
                        class="flex flex-col gap-1 text-sm font-semibold text-indigo-600 dark:text-indigo-400"
                    >
                        <div>
                            <a
                                href={programme?.path ?? "#"}
                                class={`inline-flex items-center gap-2 rounded-md px-2 py-1 text-xs font-medium transition-transform duration-200 ease-out hover:scale-105 focus-visible:scale-105 ${theme.badgeBg} ${theme.badgeText} ${theme.badgeRing}`}
                            >
                                {
                                    programme?.icon && (
                                        <i class={programme.icon} />
                                    )
                                }
                                <span>{programme?.name}</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="mt-8">
                    <a
                        href="#eligibility-checker"
                        aria-label="Start a free trial on the Starter plan"
                        class="inline-block rounded-md bg-violet-600 px-3.5 py-2 text-center text-sm/6 font-semibold text-white shadow-xs hover:bg-violet-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-600 dark:bg-violet-500 dark:shadow-none dark:hover:bg-violet-600 dark:focus-visible:outline-violet-400 transition-transform duration-200 ease-out hover:scale-105 focus-visible:scale-105"
                        >Check your eligibility</a
                    >
                </div>
                <div class="flex items-center py-8">
                    <div
                        aria-hidden="true"
                        class:list={["w-full border-t", dividerBorder]}
                    >
                    </div>
                </div>
                <div class="">
                    <h3 class:list={["text-sm/6 font-medium", headingText]}>
                        Your grant usability:
                    </h3>

                    <ul class="mt-3 space-y-3">
                        {
                            grantUsabilityEntries.map(([label, isIncluded]) => (
                                <li
                                    data-disabled={
                                        !isIncluded ? "true" : undefined
                                    }
                                    class:list={[
                                        "group flex items-start gap-2 text-xs/6",
                                        listText,
                                    ]}
                                >
                                    <span class="inline-flex h-6 items-center">
                                        <i
                                            class={
                                                isIncluded
                                                    ? "fa-sharp fa-solid fa-circle-check"
                                                    : "fa-sharp fa-regular fa-circle-xmark"
                                            }
                                        />
                                    </span>
                                    <span>
                                        {!isIncluded && (
                                            <span class="sr-only">
                                                Not included:
                                            </span>
                                        )}
                                        {label}
                                    </span>
                                </li>
                            ))
                        }
                    </ul>
                </div>
            </div>

            <div class="p-5 pb-4">
                <div class="pb-4">
                    <h3 class:list={["text-sm/6 font-medium", headingText]}>
                        Your programme services:
                    </h3>
                </div>
                <a
                    href={programme?.path ?? "#"}
                    class={`block rounded-lg px-5 py-4 transition-transform duration-200 ease-out hover:scale-105 focus-visible:scale-105 ${theme.servicesBg} ${theme.servicesText} ${theme.servicesRing}`}
                >
                    <ul class="space-y-3">
                        {
                            services.map((service) => (
                                <li
                                    class={`group flex items-start gap-3 text-xs/6 ${theme.serviceItemText}`}
                                >
                                    <span class="inline-flex h-6 items-center">
                                        {service.icon && (
                                            <i class={service.icon} />
                                        )}
                                    </span>

                                    {service.name}
                                </li>
                            ))
                        }
                    </ul>
                </a>
            </div>
        </div>
    </div>
</div>
