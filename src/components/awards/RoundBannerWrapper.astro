---
/**
 * RoundBannerWrapper.astro
 * Astro wrapper for RoundBanner React component
 *
 * Fetches round data server-side and passes processed data to the client-side React component
 */

// Data processing happens server-side
import { rounds } from "@data/rounds.js";
import {
    processAllRounds,
    getDeadlineUrgency,
} from "@utils/application-rounds.js";
import { getDevDateTimeString } from "@config/dev.config.js";

// React component
import RoundBanner from "./RoundBanner";

// Process rounds server-side
const { currentRound, nextOpenRound, hasNoRounds, hasNoFutureRounds } =
    processAllRounds(rounds);

// Get dev datetime for client-side (if set)
const devDateTime = getDevDateTimeString();

// Prepare serializable data for the React component
const roundData = currentRound
    ? {
          id: currentRound.id,
          opensDate: currentRound.opensDate,
          closesDate: currentRound.closesDate,
          resultsStart: currentRound.resultsStart,
          resultsEnd: currentRound.resultsEnd,
          hasCapacity: currentRound.hasCapacity ?? false,
          capacityPercentage: currentRound.capacityPercentage ?? 0,
          isOpen: currentRound.isOpen,
          isUpcoming: currentRound.isUpcoming,
          isInAssessment: currentRound.isInAssessment,
          isInResults: currentRound.isInResults,
          isCompleted: currentRound.isCompleted,
          phase: currentRound.phase,
          dates: currentRound.dates,
          phaseInfo: currentRound.phaseInfo,
      }
    : null;

const nextRoundData = nextOpenRound
    ? {
          id: nextOpenRound.id,
          opensDate: nextOpenRound.opensDate,
          closesDate: nextOpenRound.closesDate,
          resultsStart: nextOpenRound.resultsStart,
          resultsEnd: nextOpenRound.resultsEnd,
          hasCapacity: nextOpenRound.hasCapacity ?? false,
          capacityPercentage: nextOpenRound.capacityPercentage ?? 0,
          isOpen: nextOpenRound.isOpen,
          isUpcoming: nextOpenRound.isUpcoming,
          isInAssessment: nextOpenRound.isInAssessment ?? false,
          isInResults: nextOpenRound.isInResults ?? false,
          isCompleted: nextOpenRound.isCompleted ?? false,
          dates: nextOpenRound.dates,
      }
    : null;
---

<RoundBanner
    client:load
    round={roundData}
    nextRound={nextRoundData}
    devDateTime={devDateTime}
/>
