---
/**
 * ApplicationRoundsProcess Component
 * Displays the application process steps and assessment stages
 * Can show/hide resource links based on `showLinks` prop
 */

import Container from "@components/Container.astro";
import CurrentRoundCard from "@components/awards/CurrentRoundCard.astro";

// DATA
import { rounds } from "@data/rounds.js";
import { processAllRounds } from "@utils/application-rounds.js";

interface Props {
    showLinks?: boolean;
    showApplyButton?: boolean;
}

const { showLinks = false, showApplyButton = false } = Astro.props;

// Process all rounds from Directus
const {
    all: applicationRounds,
    currentRound,
    nextOpenRound,
} = processAllRounds(rounds);

const beforeSteps = [
    {
        step: "1",
        title: "Check Eligibility",
        description:
            "Use our eligibility checker to confirm you meet all criteria.",
    },
    {
        step: "2",
        title: "Preview Application",
        description:
            "Download a copy to understand what's required and draft your answers.",
        linkLabel: showLinks ? "Download preview" : null,
        linkHref: "/resources/application-form-preview",
        linkIcon: "fa-solid fa-download",
    },
    {
        step: "3",
        title: "Prepare Your Budget",
        description:
            "Learn what you can include and how to present your Award budget.",
        linkLabel: showLinks ? "Budget guidance" : null,
        linkHref: "/resources/award-budget-guidance",
        linkIcon: "fa-regular fa-file-lines",
    },
    {
        step: "4",
        title: "Submit Application",
        description:
            "Complete and submit through our online portal before the round closes.",
    },
];

const assessmentStages = [
    {
        title: "Suitability Check",
        description:
            "Reviewed against social impact, inclusion, and financial sustainability.",
        icon: "fa-solid fa-shield",
    },
    {
        title: "Peer Review",
        description:
            "Support Managers discuss your application; strong ones go to panel.",
        icon: "fa-solid fa-people-group",
    },
    {
        title: "Panel Meeting",
        description:
            "Discuss your application with staff and experienced entrepreneurs.",
        icon: "fa-solid fa-chalkboard-user",
        linkLabel: showLinks ? "Panel Meeting Guide" : null,
        linkHref: "/resources/panel-meeting-guide",
    },
    {
        title: "Committee Approval",
        description:
            "Recommendations go to the Awards Committee for final approval.",
        icon: "fa-solid fa-user-check",
    },
];

const successList = [
    "Welcome pack with information about joining your cohort",
    "Budget & reporting guidance to help you manage your Award",
    "Support Manager introduction to begin your journey",
];

const unsuccessfulList = [
    "Feedback on your application to help you improve",
    "Resources to continue developing your venture",
    "Encouragement to reapply in a future round",
];

// Determine if round is open for the Apply button
const isRoundOpen = currentRound?.isOpen && !currentRound?.isCapacityFull;
---

<Container bg="bg-violet-950">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center mb-16">
            <span
                class="inline-flex items-center rounded-full bg-violet-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-violet-700"
            >
                Application Timeline
            </span>
            <h2
                class="text-3xl md:text-4xl font-bold text-foreground mb-4 text-balance text-violet-50 mt-4"
            >
                When to Apply
            </h2>
            <p
                class="text-lg text-muted-foreground max-w-2xl mx-auto text-violet-200"
            >
                We assess applications in terms. When you submit affects when
                you'll receive a decision. Plan your application around these
                rounds.
            </p>
        </div>

        <CurrentRoundCard
            currentRound={currentRound}
            nextOpenRound={nextOpenRound}
            allRounds={applicationRounds}
        />

        {
            showApplyButton && (
                <div class="mt-8 text-center">
                    {isRoundOpen ? (
                        <a
                            href="https://portal.unltd.org.uk/apply"
                            class="inline-flex items-center gap-2 px-8 py-4 bg-amber-500 hover:bg-amber-400 text-amber-950 font-bold rounded-xl text-lg transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105"
                        >
                            <i class="fa-solid fa-rocket" aria-hidden="true" />
                            Apply Now
                            <i
                                class="fa-solid fa-arrow-right"
                                aria-hidden="true"
                            />
                        </a>
                    ) : (
                        <div class="inline-flex items-center gap-2 px-8 py-4 bg-violet-800 text-violet-400 font-semibold rounded-xl text-lg cursor-not-allowed">
                            <i class="fa-solid fa-clock" aria-hidden="true" />
                            Applications open{" "}
                            {currentRound?.dates?.opens || "soon"}
                        </div>
                    )}
                </div>
            )
        }

        <div class="mt-16">
            <h3
                class="text-2xl font-bold text-foreground mb-4 text-center text-violet-50"
            >
                The Application Process
            </h3>
            <p
                class="text-muted-foreground text-center max-w-2xl mx-auto mb-12 text-violet-200"
            >
                All submitted applications undergo a thorough assessment
                process. Here's what to expect at each stage.
            </p>

            <!-- Before You Apply Section -->
            <div class="mb-12">
                <div class="flex items-center gap-4 mb-6">
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-100 rounded-full"
                    >
                        <i
                            class="fa-solid fa-calendar-day h-4 w-4 text-violet-600"
                        ></i>
                        <span class="text-sm font-semibold text-violet-700"
                            >Opens</span
                        >
                    </div>
                    <div class="flex-1 h-px bg-violet-200"></div>
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-100 rounded-full"
                    >
                        <i class="fa-regular fa-clock h-4 w-4 text-violet-600"
                        ></i>
                        <span class="text-sm font-semibold text-violet-700"
                            >Closes</span
                        >
                    </div>
                </div>

                <div
                    class="bg-gradient-to-r from-violet-50 to-violet-100/50 rounded-2xl p-6 border border-violet-200"
                >
                    <h4 class="text-lg font-bold text-violet-900 mb-2">
                        Before You Apply
                    </h4>
                    <p class="text-sm text-violet-700 mb-6">
                        Complete these steps during the application round ({
                            currentRound?.dates?.opensShort
                        } – {currentRound?.dates?.closesShort})
                    </p>

                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {
                            beforeSteps.map((step) => (
                                <div class="border border-violet-200 bg-white rounded-2xl p-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-violet-600 text-white font-bold text-sm mb-3">
                                        {step.step}
                                    </div>
                                    <h5 class="font-semibold text-foreground mb-1 text-sm">
                                        {step.title}
                                    </h5>
                                    <p
                                        class={`text-xs text-muted-foreground ${step.linkLabel ? "mb-2" : ""}`}
                                    >
                                        {step.description}
                                    </p>
                                    {step.linkLabel && (
                                        <a
                                            href={step.linkHref}
                                            target="_blank"
                                            class="inline-flex items-center gap-1 text-xs font-medium text-violet-600 hover:text-violet-700"
                                        >
                                            <i
                                                class={`${step.linkIcon} text-[11px]`}
                                            />
                                            {step.linkLabel}
                                        </a>
                                    )}
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>

            <!-- Assessment Process Section -->
            <div class="mb-12">
                <div class="flex items-center gap-4 mb-6">
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-200 rounded-full"
                    >
                        <i
                            class="fa-solid fa-magnifying-glass-chart h-4 w-4 text-violet-700"
                        ></i>
                        <span class="text-sm font-semibold text-violet-800"
                            >Assessment Starts</span
                        >
                    </div>
                    <div class="flex-1 h-px bg-violet-300"></div>
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-200 rounded-full"
                    >
                        <i
                            class="fa-solid fa-clipboard-check h-4 w-4 text-violet-700"
                        ></i>
                        <span class="text-sm font-semibold text-violet-800"
                            >Assessment Ends</span
                        >
                    </div>
                </div>

                <div
                    class="bg-gradient-to-r from-violet-100 to-violet-200/50 rounded-2xl p-6 border border-violet-300"
                >
                    <h4 class="text-lg font-bold text-violet-900 mb-2">
                        Assessment Process
                    </h4>
                    <p class="text-sm text-violet-700 mb-6">
                        Your application is reviewed during this period ({
                            currentRound?.dates?.assessmentStartShort
                        } – {currentRound?.dates?.assessmentEndShort})
                    </p>

                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {
                            assessmentStages.map((stage) => (
                                <div class="border border-violet-300 bg-white rounded-2xl p-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-violet-900 text-white mb-3">
                                        <i class={`${stage.icon} text-sm`} />
                                    </div>
                                    <h5 class="font-semibold text-foreground mb-1 text-sm">
                                        {stage.title}
                                    </h5>
                                    <p
                                        class={`text-xs text-muted-foreground ${stage.linkLabel ? "mb-2" : ""}`}
                                    >
                                        {stage.description}
                                    </p>
                                    {stage.linkLabel && (
                                        <a
                                            href={stage.linkHref}
                                            class="inline-flex items-center gap-1 text-xs font-medium text-violet-600 hover:text-violet-700"
                                        >
                                            <i class="fa-regular fa-file-lines text-[11px]" />
                                            {stage.linkLabel}
                                        </a>
                                    )}
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div>
                <div class="flex items-center gap-4 mb-6">
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-300 rounded-full"
                    >
                        <i
                            class="fa-regular fa-envelope h-4 w-4 text-violet-800"
                        ></i>
                        <span class="text-sm font-semibold text-violet-900"
                            >Results Start</span
                        >
                    </div>
                    <div class="flex-1 h-px bg-violet-400"></div>
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-violet-300 rounded-full"
                    >
                        <i
                            class="fa-regular fa-circle-check h-4 w-4 text-violet-800"
                        ></i>
                        <span class="text-sm font-semibold text-violet-900"
                            >Results End</span
                        >
                    </div>
                </div>

                <div
                    class="bg-gradient-to-r from-violet-200 to-violet-300/40 rounded-2xl p-6 border border-violet-400"
                >
                    <h4 class="text-lg font-bold text-violet-900 mb-2">
                        Results & Next Steps
                    </h4>
                    <p class="text-sm text-violet-800 mb-6">
                        Hear back between {
                            currentRound?.dates?.resultsStartShort
                        } – {currentRound?.dates?.resultsEndShort}. You'll
                        receive one of the following outcomes.
                    </p>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div
                            class="border border-violet-400 bg-white rounded-2xl p-5"
                        >
                            <div class="flex items-center gap-3 mb-4">
                                <span
                                    class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-700 flex items-center justify-center"
                                >
                                    <i class="fa-solid fa-champagne-glasses"
                                    ></i>
                                </span>
                                <div>
                                    <p
                                        class="text-xs font-semibold text-emerald-700"
                                    >
                                        If you're successful
                                    </p>
                                    <h5
                                        class="text-base font-semibold text-foreground"
                                    >
                                        Welcome to the Awards community
                                    </h5>
                                </div>
                            </div>
                            <ul class="space-y-2 text-sm text-muted-foreground">
                                {
                                    successList.map((item) => (
                                        <li class="flex items-start gap-2">
                                            <i class="fa-solid fa-circle-check text-emerald-500 mt-1" />
                                            <span>{item}</span>
                                        </li>
                                    ))
                                }
                            </ul>
                        </div>

                        <div
                            class="border border-violet-400 bg-white rounded-2xl p-5"
                        >
                            <div class="flex items-center gap-3 mb-4">
                                <span
                                    class="w-10 h-10 rounded-full bg-rose-100 text-rose-700 flex items-center justify-center"
                                >
                                    <i class="fa-solid fa-arrow-rotate-left"
                                    ></i>
                                </span>
                                <div>
                                    <p
                                        class="text-xs font-semibold text-rose-700"
                                    >
                                        If you're unsuccessful
                                    </p>
                                    <h5
                                        class="text-base font-semibold text-foreground"
                                    >
                                        Support to try again
                                    </h5>
                                </div>
                            </div>
                            <ul class="space-y-2 text-sm text-muted-foreground">
                                {
                                    unsuccessfulList.map((item) => (
                                        <li class="flex items-start gap-2">
                                            <i class="fa-regular fa-circle-xmark text-rose-500 mt-1" />
                                            <span>{item}</span>
                                        </li>
                                    ))
                                }
                            </ul>
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <p class="text-sm text-violet-900">
                            Questions about timelines? Email <a
                                class="underline"
                                href="mailto:awards@unltd.org.uk"
                                >awards@unltd.org.uk</a
                            > and we'll guide you.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</Container>
