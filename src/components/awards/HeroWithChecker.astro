---
import Container from "@components/Container.astro";
import { rounds } from "@data/rounds.js";
import moment from "moment";

const benefits = [
    { text: "No account required", icon: "fa-regular fa-circle-check" },
    { text: "Instant results", icon: "fa-regular fa-sparkles" },
    { text: "Next steps sent via email", icon: "fa-regular fa-envelope" },
];

const checkerUrl = "https://unltduk.typeform.com/awards-checker";

// Get current date
const now = new Date();

// Safely handle rounds data
const roundsData = rounds || [];

// Find current open round (applications are open now)
const currentRound = roundsData.find((round) => {
    const start = new Date(round.applications_start);
    const end = new Date(round.applications_end);
    return now >= start && now <= end;
});

// Find next upcoming round (applications haven't started yet)
const nextRound = roundsData
    .filter((round) => new Date(round.applications_start) > now)
    .sort(
        (a, b) =>
            new Date(a.applications_start) - new Date(b.applications_start),
    )[0];

// Determine status
const isOpen = !!currentRound;
const activeRound = currentRound || nextRound;
---

<section class="bg-violet-950 py-16 lg:py-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
            class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-start"
        >
            <!-- Left: Hero Content -->
            <div class="lg:pr-8">
                <p class="text-base font-semibold leading-7 text-amber-500">
                    For social entrepreneurs
                </p>
                <h1
                    class="mt-2 text-4xl font-bold tracking-tight text-white sm:text-5xl lg:text-6xl"
                >
                    Awards
                </h1>
                <p
                    class="mt-6 text-lg leading-8 font-medium text-pretty text-violet-300 sm:text-xl/8"
                >
                    An award is a grant and enrollment onto one of our
                    programmes;
                    <a
                        href="/awards/millennium-awards-trust"
                        class="cursor-pointer inline-flex items-center rounded-md bg-yellow-400/30 px-2 py-1 text-lg font-medium text-yellow-400 inset-ring inset-ring-yellow-400/20 transition-transform duration-200 ease-out hover:scale-105 focus-visible:scale-105"
                    >
                        Millennium Awards Trust
                    </a>
                    or
                    <a
                        href="/awards/funding-futures-programme"
                        class="cursor-pointer inline-flex items-center rounded-md bg-purple-400/30 px-2 py-1 text-lg font-medium text-purple-400 inset-ring inset-ring-purple-400/20 transition-transform duration-200 ease-out hover:scale-105 focus-visible:scale-105"
                    >
                        Funding Futures Programme
                    </a>. We offer two types of Awards, starting up awards for
                    early stage social entrepreneurs and scaling-up for social
                    entrepreneurs who've been trading for over a year.
                </p>

                <!-- Navigation Cards -->
                <div class="mt-10 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Application Rounds Widget -->
                    <a
                        href="/awards1/application-rounds"
                        class="group bg-violet-900/50 rounded-xl p-5 border border-violet-800 hover:bg-violet-800/50 hover:border-violet-600 transition-all duration-200"
                    >
                        <div class="flex flex-col justify-between mb-3">
                            <h3
                                class="font-semibold text-white flex items-center gap-2"
                            >
                                <i
                                    class="fa-regular fa-calendar-clock h-5 w-5 text-violet-400 group-hover:text-amber-400 transition-colors"
                                    aria-hidden="true"></i>
                                Application rounds
                            </h3>
                            <div>
                                {
                                    isOpen ? (
                                        <span class="inline-flex items-center gap-1 rounded-full bg-green-500/20 px-2 py-0.5 text-xs font-semibold text-green-400 border border-green-500/30">
                                            <span class="relative flex h-2 w-2">
                                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75" />
                                                <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500" />
                                            </span>
                                            Open now
                                        </span>
                                    ) : (
                                        <span class="inline-flex items-center gap-1 rounded-full bg-amber-500/20 px-2 py-0.5 text-xs font-semibold text-amber-400 border border-amber-500/30">
                                            <i
                                                class="fa-regular fa-clock h-3 w-3"
                                                aria-hidden="true"
                                            />
                                            Coming soon
                                        </span>
                                    )
                                }
                            </div>

                            {
                                activeRound ? (
                                    <div class="space-y-2">
                                        <p class="text-violet-200 text-sm font-medium">
                                            {activeRound.name}
                                        </p>
                                        {isOpen ? (
                                            <p class="text-violet-300 text-xs">
                                                <span class="text-violet-400">
                                                    Closes:
                                                </span>{" "}
                                                {moment(
                                                    activeRound.applications_end,
                                                ).format("ddd D MMM YYYY")}
                                                <span class="text-violet-500 ml-1">
                                                    (
                                                    {moment(
                                                        activeRound.applications_end,
                                                    ).fromNow()}
                                                    )
                                                </span>
                                            </p>
                                        ) : (
                                            <p class="text-violet-300 text-xs">
                                                <span class="text-violet-400">
                                                    Opens:
                                                </span>{" "}
                                                {moment(
                                                    activeRound.applications_start,
                                                ).format("ddd D MMM YYYY")}
                                                <span class="text-violet-500 ml-1">
                                                    (
                                                    {moment(
                                                        activeRound.applications_start,
                                                    ).fromNow()}
                                                    )
                                                </span>
                                            </p>
                                        )}
                                    </div>
                                ) : (
                                    <p class="text-violet-300 text-sm leading-relaxed">
                                        No upcoming rounds scheduled. Check back
                                        soon for updates.
                                    </p>
                                )
                            }
                        </div>

                        <span
                            class="inline-flex items-center gap-1 text-sm font-medium text-amber-400 group-hover:text-amber-300 mt-3"
                        >
                            View all rounds
                            <i
                                class="fa-solid fa-arrow-right h-3 w-3 transition-transform group-hover:translate-x-1"
                                aria-hidden="true"></i>
                        </span>
                    </a>

                    <a
                        href="/awards1/eligibility-criteria"
                        class="group bg-violet-900/50 rounded-xl p-5 border border-violet-800 hover:bg-violet-800/50 hover:border-violet-600 transition-all duration-200"
                    >
                        <h3
                            class="font-semibold text-white mb-2 flex items-center gap-2"
                        >
                            <i
                                class="fa-regular fa-table h-5 w-5 text-violet-400 group-hover:text-amber-400 transition-colors"
                                aria-hidden="true"></i>
                            Eligibility criteria
                        </h3>
                        <p class="text-violet-300 text-sm leading-relaxed mb-3">
                            Compare eligibility criteria across all our awards
                            at a glance.
                        </p>
                        <span
                            class="inline-flex items-center gap-1 text-sm font-medium text-amber-400 group-hover:text-amber-300"
                        >
                            View criteria
                            <i
                                class="fa-solid fa-arrow-right h-3 w-3 transition-transform group-hover:translate-x-1"
                                aria-hidden="true"></i>
                        </span>
                    </a>
                </div>
            </div>

            <!-- Right: Eligibility Checker -->
            <div id="eligibility-checker" class="lg:sticky lg:top-8">
                <!-- <div class="text-center mb-6">
                    <span
                        class="inline-flex items-center rounded-full bg-amber-500 text-amber-950 px-3 py-1 text-sm font-semibold mb-3"
                    >
                        Required First Step
                    </span>
                    <h2
                        id="eligibility"
                        class="text-2xl md:text-3xl font-bold text-white mb-3"
                    >
                        Take the Eligibility Checker
                    </h2>
                    <p class="text-violet-300 text-sm max-w-md mx-auto">
                        Everyone must complete the eligibility checker to begin
                        their application rounds. It's the fastest way to find
                        out which awards you qualify for.
                    </p>
                </div> -->

                <div
                    class="bg-violet-950 rounded-2xl overflow-hidden shadow-2xl border border-violet-100"
                >
                    <div
                        class="bg-violet-100 px-4 py-2.5 border-b border-violet-100 flex items-center justify-between"
                    >
                        <span
                            class="inline-flex items-center rounded-full bg-amber-500 text-amber-950 px-3 py-1 text-sm font-semibold"
                        >
                            Required First Step
                        </span>
                        <a
                            href={checkerUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-1 rounded-full px-3 py-1 text-sm font-semibold text-violet-900 hover:text-violet-800 transition-colors"
                        >
                            Open in new tab
                            <i
                                class="fa-regular fa-arrow-up-right-from-square h-3 w-3"
                                aria-hidden="true"></i>
                        </a>
                    </div>

                    <div class="relative bg-violet-950">
                        <div
                            data-tf-live="01KA7RWQS22SHZE07GHDBWDV37"
                            title="Eligibility Checker"
                            class="w-full border-0"
                            loading="lazy"
                        >
                        </div>
                    </div>

                    <div class="flex flex-wrap justify-center gap-4 mb-6">
                        {
                            benefits.map((item) => (
                                <div class="flex items-center gap-2 text-xs">
                                    <i
                                        class={`${item.icon} h-3.5 w-3.5 text-violet-400`}
                                        aria-hidden="true"
                                    />
                                    <span class="text-violet-300">
                                        {item.text}
                                    </span>
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
