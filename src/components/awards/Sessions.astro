---
import Icon from "@components/Icon.astro";
import { programmes } from "@data/programmes.js";
import {
    programmeEvents as fetchedProgrammeEvents,
    isPastEvent,
    sortEvents,
} from "@data/eventCollections";
import Container from "@components/Container.astro";

// Filter programmes to only show those with 'published' status
const publishedProgrammes = programmes.filter(
    (programme) => programme.status === "published",
);

const EVENTBRITE_PROGRAMMES_COLLECTION_URL =
    typeof process !== "undefined" &&
    process.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL
        ? process.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL
        : (import.meta.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL ??
          "https://www.eventbrite.com/cc/for-social-entrepreneurs-4794111");

const programmeEvents = sortEvents(fetchedProgrammeEvents).filter(
    (event) => event.start?.local && !isPastEvent(event),
);

const ONE_TO_ONE_BOOKING_URL =
    "https://outlook.office365.com/book/G42610266167744e1ae64a423288c9b38@unltd.org.uk";
---

<div class="flex flex-col gap-16">
    <!-- Main Section Header -->
    <div class="text-center">
        <h2
            class="text-3xl md:text-4xl font-bold text-violet-900 dark:text-violet-100 mb-4"
        >
            Need applcation assistance?
        </h2>
        <p
            class="text-lg text-violet-700 dark:text-violet-300 max-w-3xl mx-auto"
        >
            We're here to help you on your journey. Whether you'd like to attend
            an information session, need one-to-one assistance with your
            application, or are looking for local support networks in Wales, we
            have options to support you.
        </p>
    </div>

    <!-- Events Section -->
    {
        programmeEvents.length > 0 && (
            <div class="flex flex-col gap-8">
                <div class="text-center">
                    <span class="inline-flex items-center rounded-full bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 inset-ring inset-ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-500 dark:inset-ring-yellow-400/20">
                        For anyone
                    </span>
                    <h3 class="text-2xl font-bold text-violet-900 dark:text-violet-100 mb-3">
                        Information sessions
                    </h3>
                    <p class="text-base text-violet-700 dark:text-violet-300 max-w-2xl mx-auto">
                        We run regular information sessions, where you will get
                        an overview of UnLtd Awards and programmes, support
                        available, and the application process. You will also
                        have the chance to ask any questions.
                    </p>
                </div>
                <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
                    {programmeEvents.map((event) => {
                        const startDate = new Date(event.start.local);
                        const endDate = event.end?.local
                            ? new Date(event.end.local)
                            : null;
                        const description =
                            event.summary ?? event.description?.text ?? "";
                        const truncatedDescription =
                            description.length > 160
                                ? `${description.substring(0, 157).trimEnd()}...`
                                : description;
                        const locationLabel = event.online_event
                            ? "Online"
                            : (event.venue?.name ?? "Venue to be confirmed");
                        const statusLabel = event.status
                            ? event.status.replace(/_/g, " ")
                            : "Event";
                        const dateLabel = startDate.toLocaleDateString(
                            "en-GB",
                            {
                                weekday: "long",
                                day: "numeric",
                                month: "long",
                                year: "numeric",
                            },
                        );
                        const startTime = startDate.toLocaleTimeString(
                            "en-GB",
                            {
                                hour: "2-digit",
                                minute: "2-digit",
                            },
                        );
                        const endTime = endDate
                            ? endDate.toLocaleTimeString("en-GB", {
                                  hour: "2-digit",
                                  minute: "2-digit",
                              })
                            : null;
                        const timeLabel = endTime
                            ? `${startTime} â€“ ${endTime}`
                            : startTime;
                        const timezoneLabel = event.start?.timezone
                            ? ` ${event.start.timezone}`
                            : "";
                        const locationIcon = event.online_event
                            ? "video"
                            : "location-dot";
                        const attendanceIcon = event.online_event
                            ? "laptop"
                            : "people-group";
                        const attendanceLabel = event.online_event
                            ? "Virtual session"
                            : "In-person session";
                        const headerWeekday = startDate.toLocaleDateString(
                            "en-GB",
                            {
                                weekday: "short",
                            },
                        );
                        const headerMonth = startDate.toLocaleDateString(
                            "en-GB",
                            {
                                month: "short",
                            },
                        );

                        return (
                            <article class="group relative flex flex-col overflow-hidden rounded-2xl border border-violet-200 bg-white/90 shadow-sm transition duration-500 hover:-translate-y-2 hover:shadow-2xl dark:border-violet-900/60 dark:bg-violet-950/80">
                                <div class="relative flex items-center gap-4 bg-linear-to-r from-violet-900 to-amber-900 p-6 text-violet-50">
                                    <div class="flex h-16 w-16 flex-col items-center justify-center rounded-xl bg-violet-950/40 text-xs font-semibold uppercase tracking-wide">
                                        <span>{headerWeekday}</span>
                                        <span class="text-2xl font-bold leading-none">
                                            {startDate.getDate()}
                                        </span>
                                        <span>{headerMonth}</span>
                                    </div>
                                    <div class="flex flex-1 flex-col gap-1">
                                        <span class="text-xs font-semibold uppercase tracking-[0.18em] text-violet-100/70">
                                            {statusLabel}
                                        </span>
                                        <h3 class="text-md font-semibold leading-tight">
                                            <a
                                                href={event.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                class="relative inline-flex items-start gap-2 pr-8 text-violet-50 transition-colors duration-300 hover:text-white focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white"
                                            >
                                                <span class="absolute inset-0" />
                                                {event.name.text}
                                            </a>
                                        </h3>
                                    </div>
                                    <span
                                        class="pointer-events-none absolute -right-10 top-1/2 hidden h-32 w-32 -translate-y-1/2 rounded-full bg-white/20 blur-2xl opacity-0 transition-opacity duration-500 group-hover:opacity-100 md:block"
                                        aria-hidden="true"
                                    />
                                </div>
                                <div class="flex flex-1 flex-col gap-5 p-6">
                                    {truncatedDescription && (
                                        <p class="text-sm leading-relaxed text-violet-800 dark:text-violet-200">
                                            {truncatedDescription}
                                        </p>
                                    )}
                                    <dl class="grid gap-3 text-sm text-violet-700 dark:text-violet-200">
                                        <div class="flex items-center gap-2">
                                            <Icon
                                                name="calendar-days"
                                                style="regular"
                                                class="text-violet-500"
                                            />
                                            <span>{dateLabel}</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <Icon
                                                name="clock"
                                                style="regular"
                                                class="text-violet-500"
                                            />
                                            <span>
                                                {timeLabel}
                                                {timezoneLabel}
                                            </span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <Icon
                                                name={locationIcon}
                                                style="solid"
                                                class="text-violet-500"
                                            />
                                            <span>{locationLabel}</span>
                                        </div>
                                    </dl>
                                    <div class="mt-auto flex items-center justify-between gap-3 border-t border-violet-100 pt-4 text-xs font-semibold uppercase tracking-[0.24em] text-violet-600 dark:border-violet-900/60 dark:text-violet-300">
                                        <span class="flex items-center gap-2">
                                            <Icon
                                                name={attendanceIcon}
                                                style="solid"
                                                class="text-violet-500"
                                            />
                                            {attendanceLabel}
                                        </span>
                                        <a
                                            href={event.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="inline-flex items-center gap-2 rounded-full bg-violet-900 px-4 py-2 text-xs text-violet-50 transition duration-300 hover:bg-violet-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-500 dark:bg-violet-700 dark:hover:bg-violet-500 whitespace-nowrap tracking-normal normal-case"
                                        >
                                            Reserve spot
                                            <Icon
                                                name="arrow-up-right-from-square"
                                                style="solid"
                                                class="text-xs"
                                            />
                                        </a>
                                    </div>
                                </div>
                            </article>
                        );
                    })}
                    {/* Empty placeholder cards to fill the grid */}
                    {Array.from({
                        length: (3 - (programmeEvents.length % 3)) % 3,
                    }).map((_, i) => (
                        <div class="flex flex-col items-center justify-center rounded-2xl border-2 border-dashed border-violet-300 bg-violet-50/50 p-6 min-h-70 dark:border-violet-700 dark:bg-violet-950/30">
                            <div class="w-12 h-12 rounded-full bg-violet-100 dark:bg-violet-900/50 flex items-center justify-center mb-4">
                                <Icon
                                    name="calendar-plus"
                                    style="solid"
                                    class="text-xl text-violet-400 dark:text-violet-600"
                                />
                            </div>
                            <p class="text-sm font-medium text-violet-500 dark:text-violet-400 mb-1">
                                More sessions coming soon
                            </p>
                            <p class="text-xs text-violet-400 dark:text-violet-500 text-center">
                                Check back for upcoming information sessions
                            </p>
                        </div>
                    ))}
                </div>
            </div>
        )
    }

    <div class="flex flex-row gap-10">
        <!-- 1-to-1 Application Assistance Section -->
        <div class="flex-1 flex flex-col gap-6">
            <div>
                <span
                    class="inline-flex items-center rounded-full bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 inset-ring inset-ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-500 dark:inset-ring-yellow-400/20"
                    >For those with additional support needs and who may face
                    barriers
                </span>
                <h3
                    class="text-2xl font-bold text-violet-900 dark:text-violet-100 mb-3"
                >
                    One-to-one application assistance
                </h3>
                <p
                    class="text-base text-violet-700 dark:text-violet-300 max-w-2xl mx-auto"
                >
                    Book a one-to-one session with our team to get personalised
                    support with your application.
                </p>
            </div>

            <div class="">
                <div
                    class="rounded-2xl border border-violet-200 bg-white/90 p-8 dark:border-violet-900/60 dark:bg-violet-950/80"
                >
                    <p class="text-violet-800 dark:text-violet-200 mb-6">
                        Our one-to-one sessions can help you with:
                    </p>
                    <ul class="space-y-3 mb-8">
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-emerald-500 mt-0.5 shrink-0"
                            />
                            <span>Understanding the application process</span>
                        </li>
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-emerald-500 mt-0.5 shrink-0"
                            />
                            <span>Talking through the application form</span>
                        </li>
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-emerald-500 mt-0.5 shrink-0"
                            />
                            <span>Discussing our current programmes</span>
                        </li>
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-emerald-500 mt-0.5 shrink-0"
                            />
                            <span
                                >Discussing adjustments we can make to reduce
                                barriers to applying</span
                            >
                        </li>
                    </ul>

                    <div
                        class="bg-violet-50 dark:bg-violet-900/30 rounded-xl p-4 mb-8"
                    >
                        <p class="text-sm text-violet-700 dark:text-violet-300">
                            <Icon
                                name="lightbulb"
                                style="solid"
                                class="mr-2 text-amber-500"
                            />
                            <strong>Tip:</strong> Before booking, we recommend that
                            you
                            <a
                                href="/awards/eligibility"
                                class="underline hover:text-violet-900 dark:hover:text-violet-100"
                                >check your eligibility</a
                            >
                            for our Awards and familiarise yourself with the application.
                        </p>
                    </div>

                    <div
                        class="flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl"
                    >
                        <div
                            class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center shrink-0"
                        >
                            <Icon
                                name="eye"
                                style="solid"
                                class="text-blue-600 dark:text-blue-400"
                            />
                        </div>
                        <div>
                            <p
                                class="text-sm font-semibold text-slate-900 dark:text-slate-100 mb-1"
                            >
                                Visual impairment support
                            </p>
                            <p
                                class="text-sm text-slate-600 dark:text-slate-400"
                            >
                                If you have a visual impairment and need
                                assistance, please
                                <a
                                    href="/contact/awards"
                                    class="underline text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"
                                    >contact our awards support team</a
                                >
                                directly for tailored help.
                            </p>
                        </div>
                    </div>

                    <div
                        class="flex flex-col sm:flex-row items-center justify-center gap-4"
                    >
                        <a
                            href={ONE_TO_ONE_BOOKING_URL}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 rounded-full bg-emerald-600 px-6 py-3 text-sm font-semibold text-white transition duration-300 hover:bg-emerald-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-500"
                        >
                            <Icon name="calendar-check" style="solid" />
                            Book a session
                            <Icon
                                name="arrow-up-right-from-square"
                                style="solid"
                                class="text-xs"
                            />
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wales Support Section -->
        <div class="flex-1 flex flex-col gap-6">
            <div class="">
                <span
                    class="inline-flex items-center rounded-full bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 inset-ring inset-ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-500 dark:inset-ring-yellow-400/20"
                    >For those livng in Wales and may face barriers to applying
                </span>
                <h3
                    class="text-2xl font-bold text-violet-900 dark:text-violet-100 mb-3"
                >
                    Support for those living in Wales
                </h3>
                <p
                    class="text-base text-violet-700 dark:text-violet-300 max-w-2xl mx-auto"
                >
                    Additional support for individuals in Wales who may face
                    barriers to accessing our programmes.
                </p>
            </div>

            <div class="max-w-3xl mx-auto w-full">
                <div
                    class="rounded-2xl border border-rose-200 bg-white/90 p-8 dark:border-rose-900/60 dark:bg-violet-950/80"
                >
                    <p class="text-violet-800 dark:text-violet-200 mb-6">
                        If you live in Wales and identify as a marginalised
                        individual, we can offer:
                    </p>
                    <ul class="space-y-3 mb-8">
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-rose-500 mt-0.5 shrink-0"
                            />
                            <span
                                >An introduction to local support networks</span
                            >
                        </li>
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-rose-500 mt-0.5 shrink-0"
                            />
                            <span
                                >Advice and signposting to relevant resources</span
                            >
                        </li>
                        <li
                            class="flex items-start gap-3 text-violet-700 dark:text-violet-300"
                        >
                            <Icon
                                name="check-circle"
                                style="solid"
                                class="text-rose-500 mt-0.5 shrink-0"
                            />
                            <span
                                >Support even if you may not yet be ready for an
                                UnLtd Award</span
                            >
                        </li>
                    </ul>

                    <div
                        class="flex flex-col sm:flex-row items-center justify-center gap-4"
                    >
                        <a
                            href="/spaces/assistance-for-those-living-in-wales"
                            class="inline-flex items-center gap-2 rounded-full bg-rose-600 px-6 py-3 text-sm font-semibold text-white transition duration-300 hover:bg-rose-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-500"
                        >
                            <Icon name="arrow-right" style="solid" />
                            Learn more about Wales support
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
