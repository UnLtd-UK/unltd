---
const { styles, programme } = Astro.props;

import Video from "@components/awards/programme/content/Video.astro";
import Quote from "@components/awards/programme/content/Quote.astro";
import Post from "@components/awards/programme/content/Post.astro";
import Container from "@components/Container.astro";

const contents = [];

// Extract and add videos
programme.videos.forEach((video) => {
    if (
        video.videos_id &&
        video.videos_id.date_time &&
        video.videos_id.status == "published"
    ) {
        contents.push({ id: video.videos_id, type: "video" });
    }
});

// Extract and add quotes
programme.quotes.forEach((quote) => {
    if (
        quote.quotes_id &&
        quote.quotes_id.date_time &&
        quote.quotes_id.status == "published"
    ) {
        contents.push({ id: quote.quotes_id, type: "quote" });
    }
});

// Extract and add posts
programme.posts.forEach((post) => {
    if (
        post.posts_id &&
        post.posts_id.date_time &&
        post.posts_id.status == "published"
    ) {
        contents.push({ id: post.posts_id, type: "post" });
    }
});

// Sort contents by date_time
contents.sort((a, b) => {
    const dateA = new Date(a.id.date_time).getTime();
    const dateB = new Date(b.id.date_time).getTime();
    return dateB - dateA;
});
---

<div class={`py-16 sm:py-24 ${styles.bg2}`}>
    <Container>
        <div class="mx-auto max-w-2xl lg:max-w-none">
            <div class="text-center mb-12">
                <p
                    class={`mt-2 text-3xl font-bold tracking-tight ${styles.text} sm:text-4xl`}
                >
                    Stories & Media
                </p>
                <p
                    class={`mt-4 text-lg leading-8 ${styles.text2} max-w-2xl mx-auto`}
                >
                    Discover stories of Award Winners from this programme
                </p>
            </div>

            <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
                {
                    contents.map((content) => {
                        switch (content.type) {
                            case "video":
                                return (
                                    <Video video={content} styles={styles} />
                                );
                            case "quote":
                                return (
                                    <Quote quote={content} styles={styles} />
                                );
                            case "post":
                                return <Post post={content} styles={styles} />;
                            default:
                                return null;
                        }
                    })
                }
            </div>
        </div>
    </Container>
</div>
