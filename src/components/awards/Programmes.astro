---
import slugify from "slugify";

import { programmes } from "@data/programmes.js";
import {
  programmeEvents as fetchedProgrammeEvents,
  isPastEvent,
  sortEvents,
} from "@data/eventCollections";
import { palette } from "@data/palette.js";
import Container from "@components/Container.astro";
import ProgrammeBig from "@components/awards/programme/ProgrammeBig.astro";
import ProgrammeSmall from "@components/awards//programme/ProgrammeSmall.astro";

// Filter programmes to only show those with 'published' status
const publishedProgrammes = programmes.filter(
  (programme) => programme.status === "published",
);

const EVENTBRITE_PROGRAMMES_COLLECTION_URL =
  typeof process !== "undefined" &&
  process.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL
    ? process.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL
    : (import.meta.env.EVENTBRITE_PROGRAMMES_COLLECTION_URL ??
      "https://www.eventbrite.com/cc/for-social-entrepreneurs-4794111");

const programmeEvents = sortEvents(fetchedProgrammeEvents).filter(
  (event) => event.start?.local && !isPastEvent(event),
);
---

<Container bg="bg-violet-50 dark:bg-violet-950">
  <div class="flex flex-col gap-10 py-10">
    <div class="max-w-4xl">
      <h2
        id="programmes"
        class="mt-2 text-4xl font-bold tracking-tight text-violet-900 dark:text-violet-100 sm:text-5xl"
      >
        Programmes
      </h2>
      <p
        class="mt-6 max-w-2xl text-lg leading-8 text-violet-800 dark:text-violet-300"
      >
        Depending on your age and the sectors in which your social venture
        operates in, you will be assigned to one of our programmes for funding
        and up to a year of support. Our programmes are designed to provide
        specialised support that align with the needs of you and your social
        venture.
      </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {
        publishedProgrammes.map((programme, i) => (
          <ProgrammeSmall
            key={i}
            image={
              programme.image && programme.image.id ? programme.image.id : false
            }
            icon={programme.icon}
            styles={palette[programme.name]}
            name={programme.name}
            logo={
              programme.logo && programme.logo.id ? programme.logo.id : false
            }
            stage={programme.stage}
            age={programme.age}
            geography={programme.geography}
            focus={programme.focus}
            slogan={programme.slogan}
            description={programme.description}
            slug={slugify(programme.name, {
              lower: true,
              strict: true,
              locale: "en",
              trim: true,
            })}
            services={programme.services}
            eligibilities={programme.eligibilities}
            code={programme.code}
            from={programme.from}
            till={programme.till}
            label={programme.label}
          />
        ))
      }
    </div>
  </div>
</Container>
