---
/**
 * Resources Index - Space Picker
 * Shows all public and restricted spaces (hides unlisted)
 */

import slugify from "slugify";
import Template from "@layouts/Template.astro";
import Container from "@components/Container.astro";
import Breadcrumbs from "@components/Breadcrumbs.astro";
import HeaderSection from "@components/our-support/headerSection.astro";
import Icon from "@components/Icon.astro";

import { allSpaces } from "@data/spaces.js";

// Type definition
interface Space {
    id: string;
    name: string;
    description: string;
    access: "public" | "unlisted" | "restricted";
    restricted_password?: string;
    eventbrite_keywords?: string[];
    sort?: number;
}

const name = "Resource Hubs";
const description =
    "Access resources, guides, and support materials tailored to your journey.";

const breadcrumbs = [{ name: "Resources", path: "/resources" }];

// Filter spaces: show public and restricted, hide unlisted
const visibleSpaces = (allSpaces as Space[]).filter(
    (space) => space.access === "public" || space.access === "restricted",
);
---

<Template name={name} description={description}>
    <Container>
        <Breadcrumbs breadcrumbs={breadcrumbs} />
        <HeaderSection title={name} description={description} />

        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 pb-16">
            {
                visibleSpaces.map((space) => {
                    const spaceSlug = slugify(space.name, {
                        lower: true,
                        strict: true,
                        locale: "en",
                        trim: true,
                    });
                    const isRestricted = space.access === "restricted";

                    return (
                        <a
                            href={`/resources/${spaceSlug}`}
                            class="group relative flex flex-col overflow-hidden rounded-2xl bg-linear-to-b from-violet-800/50 to-violet-900/50 ring-1 ring-violet-700/50 hover:ring-violet-500/70 transition-all duration-300 hover:shadow-xl hover:shadow-violet-500/10 hover:-translate-y-1 p-6"
                        >
                            {/* Header */}
                            <div class="flex items-start justify-between gap-4 mb-4">
                                <div class="flex h-14 w-14 items-center justify-center rounded-xl bg-violet-500/20 ring-1 ring-violet-500/30 group-hover:bg-violet-500/30 transition-all duration-300">
                                    <Icon
                                        name="books"
                                        style="solid"
                                        class="h-7 w-7 text-violet-300 group-hover:text-violet-200"
                                    />
                                </div>
                                {isRestricted && (
                                    <span class="inline-flex items-center gap-1.5 rounded-full bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-200 ring-1 ring-amber-500/30">
                                        <Icon
                                            name="lock"
                                            style="solid"
                                            class="h-3 w-3"
                                        />
                                        Password Protected
                                    </span>
                                )}
                            </div>

                            {/* Content */}
                            <h3 class="text-xl font-bold text-violet-100 group-hover:text-white transition-colors mb-2">
                                {space.name}
                            </h3>
                            <p class="text-sm text-violet-300/80 line-clamp-3 flex-1">
                                {space.description}
                            </p>

                            {/* Footer */}
                            <div class="mt-6 pt-4 border-t border-violet-700/30 flex items-center justify-between">
                                <span class="text-sm font-medium text-violet-400 group-hover:text-violet-300 transition-colors">
                                    {isRestricted
                                        ? "Enter hub"
                                        : "Browse resources"}
                                </span>
                                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-violet-700/50 group-hover:bg-violet-600/70 transition-all duration-300 group-hover:translate-x-1">
                                    <Icon
                                        name="arrow-right"
                                        style="solid"
                                        class="h-4 w-4 text-violet-300 group-hover:text-white"
                                    />
                                </div>
                            </div>

                            {/* Hover overlay */}
                            <div class="absolute inset-0 rounded-2xl bg-linear-to-t from-violet-600/0 to-violet-400/0 group-hover:from-violet-600/5 group-hover:to-violet-400/5 transition-all duration-300 pointer-events-none" />
                        </a>
                    );
                })
            }
        </div>

        {/* Empty state */}
        {
            visibleSpaces.length === 0 && (
                <div class="text-center py-16">
                    <div class="mx-auto w-16 h-16 rounded-2xl bg-violet-800/50 flex items-center justify-center ring-1 ring-violet-700/50 mb-6">
                        <Icon
                            name="books"
                            style="solid"
                            class="h-8 w-8 text-violet-400"
                        />
                    </div>
                    <h3 class="text-lg font-semibold text-violet-200 mb-2">
                        No resource hubs available
                    </h3>
                    <p class="text-violet-400 max-w-md mx-auto">
                        Check back soon for resources and guides.
                    </p>
                </div>
            )
        }
    </Container>
</Template>
