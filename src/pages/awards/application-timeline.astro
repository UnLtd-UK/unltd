---
/**
 * ApplicationRoundsProcess Component
 * Displays the application process steps and assessment stages
 * Can show/hide resource links based on `showLinks` prop
 */

import Container from "@components/Container.astro";
import WhenToApply from "@components/awards/WhenToApply.astro";

// DATA
import { rounds } from "@data/rounds.js";
import { processAllRounds } from "@utils/application-rounds.js";

interface Props {
    showLinks?: boolean;
    showApplyButton?: boolean;
}

const { showLinks = false, showApplyButton = false } = Astro.props;

// Process all rounds from Directus
const {
    all: applicationRounds,
    currentRound,
    nextOpenRound,
} = processAllRounds(rounds);

const beforeSteps = [
    {
        step: "1",
        title: "Check Eligibility",
        description:
            "Use our eligibility checker to confirm you meet all criteria.",
    },
    {
        step: "2",
        title: "Preview Application",
        description:
            "Download a copy to understand what's required and draft your answers.",
        linkLabel: showLinks ? "Download preview" : null,
        linkHref: "/resources/application-form-preview",
        linkIcon: "fa-solid fa-download",
    },
    {
        step: "3",
        title: "Prepare Your Budget",
        description:
            "Learn what you can include and how to present your Award budget.",
        linkLabel: showLinks ? "Budget guidance" : null,
        linkHref: "/resources/award-budget-guidance",
        linkIcon: "fa-regular fa-file-lines",
    },
    {
        step: "4",
        title: "Submit Application",
        description:
            "Complete and submit through our online portal before the round closes.",
    },
];

const assessmentStages = [
    {
        title: "Suitability Check",
        description:
            "Reviewed against social impact, inclusion, and financial sustainability.",
        icon: "fa-solid fa-shield",
    },
    {
        title: "Peer Review",
        description:
            "Support Managers discuss your application; strong ones go to panel.",
        icon: "fa-solid fa-people-group",
    },
    {
        title: "Panel Meeting",
        description:
            "Discuss your application with staff and experienced entrepreneurs.",
        icon: "fa-solid fa-chalkboard-user",
        linkLabel: showLinks ? "Panel Meeting Guide" : null,
        linkHref: "/resources/panel-meeting-guide",
    },
    {
        title: "Committee Approval",
        description:
            "Recommendations go to the Awards Committee for final approval.",
        icon: "fa-solid fa-user-check",
    },
];

const successList = [
    "Welcome pack with information about joining your cohort",
    "Budget & reporting guidance to help you manage your Award",
    "Support Manager introduction to begin your journey",
];

const unsuccessfulList = [
    "Feedback on your application to help you improve",
    "Resources to continue developing your venture",
    "Encouragement to reapply in a future round",
];

// Determine if round is open for the Apply button
const isRoundOpen = currentRound?.isOpen && !currentRound?.isCapacityFull;
---

<Container bg="bg-violet-950">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center mb-16">
            <span
                class="inline-flex items-center rounded-full bg-violet-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-violet-700"
            >
                Application Timeline
            </span>
            <h2
                class="text-3xl md:text-4xl font-bold text-foreground mb-4 text-balance text-violet-50 mt-4"
            >
                When to Apply
            </h2>
            <p
                class="text-lg text-muted-foreground max-w-2xl mx-auto text-violet-200"
            >
                We assess applications in terms. When you submit affects when
                you'll receive a decision. Plan your application around these
                rounds.
            </p>
        </div>

        <WhenToApply
            currentRound={currentRound}
            nextOpenRound={nextOpenRound}
            allRounds={applicationRounds}
        />

        {
            showApplyButton && (
                <div class="mt-8 text-center">
                    {isRoundOpen ? (
                        <a
                            href="https://portal.unltd.org.uk/apply"
                            class="inline-flex items-center gap-2 px-8 py-4 bg-amber-500 hover:bg-amber-400 text-amber-950 font-bold rounded-xl text-lg transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105"
                        >
                            <i class="fa-solid fa-rocket" aria-hidden="true" />
                            Apply Now
                            <i
                                class="fa-solid fa-arrow-right"
                                aria-hidden="true"
                            />
                        </a>
                    ) : (
                        <div class="inline-flex items-center gap-2 px-8 py-4 bg-violet-800 text-violet-400 font-semibold rounded-xl text-lg cursor-not-allowed">
                            <i class="fa-solid fa-clock" aria-hidden="true" />
                            Applications open{" "}
                            {currentRound?.dates?.opens || "soon"}
                        </div>
                    )}
                </div>
            )
        }
    </div>
</Container>
