---
import Template from "../../layouts/Template.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import Container from "../../components/Container.astro";

import { programmes } from "../../data/directus/programmes.js";

import truncate from "truncate";
import moment from "moment";
import { marked } from "marked";

let todayDate = moment();

export async function getStaticPaths() {
  return programmes.map((programme) => {
    let breadcrumbs = [
      {
        name: "Awards",
        slug: "/awards",
      },
      {
        name: programme.name,
        slug: `/awards/${programme.slug}`,
      },
    ];

    programme.breadcrumbs = breadcrumbs;

    let oogle = {
      params: {
        programme: programme.slug,
      },
      props: {
        programme: programme,
      },
    };

    return oogle;
  });
}

const { programme } = Astro.props;
---

<Template name={programme.name} description={programme.description}>
  <Container>
    <Breadcrumbs breadcrumbs={programme.breadcrumbs} />

    <div class="col-span-4 flex flex-col gap-20 lg:flex-row">
      <div class="lg:basis-1/2 flex flex-col gap-8">
        <span class="relative inline-block">
          {
            programme.logo && (
              <img
                class="h-28 w-28 rounded-md"
                src={`https://unltd.directus.app/assets/${programme.logo.id}`}
                alt=""
              />
            )
          }
        </span>

        <div class="flex flex-col gap-3">
          <h1 class="text-5xl font-bold">
            {programme.name}
          </h1>
          <p class="text-lg leading-relaxed text-slate-600">
            {programme.description}
          </p>
        </div>

        <div class="flex flex-col gap-2">
          <div>
            {
              () => {
                if (
                  !todayDate.isAfter(programme.from) &&
                  !todayDate.isAfter(programme.till)
                ) {
                  return (
                    <div class="flex items-center gap-2">
                      <span class="inline-flex items-center rounded-full gap-1 bg-blue-100 px-3 py-0.5 text-sm font-medium text-blue-700">
                        <i class="fa-solid fa-circle text-blue-700 text-xs" />
                        Coming soon
                      </span>
                      <p class="text-xs text-slate-500">
                        Application window opens
                        {moment(programme.from).format(
                          "dddd hh:mma, MMMM Do YYYY",
                        )}
                      </p>
                    </div>
                  );
                } else if (!todayDate.isAfter(programme.till)) {
                  return (
                    <div class="flex items-center gap-2">
                      <span class="inline-flex items-center rounded-full gap-1 bg-green-100 px-3 py-0.5 text-sm font-medium text-green-700">
                        <i class="fa-solid fa-circle text-green-700 text-xs" />
                        Open
                      </span>
                      <p class="text-xs text-slate-500">
                        Application window closes
                        {moment(programme.till).format(
                          "dddd hh:mma, MMMM Do YYYY",
                        )}
                      </p>
                    </div>
                  );
                } else {
                  return (
                    <div class="flex items-center gap-2">
                      <span class="inline-flex items-center rounded-full gap-1 bg-red-100 px-3 py-0.5 text-sm font-medium text-red-700">
                        <i class="fa-solid fa-circle text-red-700 text-xs" />
                        Closed
                      </span>
                      <p class="text-xs text-slate-500">
                        Application window closed
                        {moment(programme.till).format(
                          "dddd hh:mma, MMMM Do YYYY",
                        )}
                      </p>
                    </div>
                  );
                }
              }
            }
          </div>
        </div>

        {
          programme.partners.length > 0 && (
            <>
              <p>Partners</p>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                {programme.partners.map((partner) => (
                  <div class="relative flex items-center space-x-3 rounded-lg border-slate-300 bg-white px-4 py-4">
                    <div class="flex-shrink-0">
                      <img
                        class="h-10 w-10 rounded-md drop-shadow-md"
                        src={`https://unltd.directus.app/assets/${partner.organisations_id.logo}`}
                        alt=""
                      />
                    </div>
                    <div class="min-w-0 flex-1">
                      <span class="absolute inset-0" aria-hidden="true" />
                      <p class="text-sm font-medium text-slate-900">
                        {partner.organisations_id.name}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )
        }
      </div>

      <div
        class="lg:basis-1/2 flex flex-col justify-center bg-blue-50 rounded-2xl"
      >
        <section
          class="overflow-hidden py-12 md:py-20 lg:py-2 relative mx-auto px-6 lg:px-8"
        >
          <blockquote class="">
            <div class="mx-auto text-xl font-medium leading-9 text-slate-900">
              <span
                >The Movement for Change programme gave Legacy Active
                Communities a space to focus on building for the future as we
                support schools and communities to encourage health and physical
                activity in young people's everyday lives. With likeminded
                social entrepreneurs, we could address challenges and
                opportunities for our social enterprise, while discussing our
                business models and opportunities for growth. We experienced
                considered, strategic, expert feedback on diversification
                opportunities - including risk and reward - to bolster our
                operations and greaten our social impact.</span
              >
              <footer class="mt-8">
                <div class="md:flex gap-4">
                  <img
                    class="inline-block h-14 w-14 rounded-full"
                    src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                    alt=""
                  />
                  <div class="mt-3 md:mt-0 md:flex md:flex-col gap-1">
                    <div class="text-base font-medium text-slate-600">
                      Shaun Fox
                    </div>

                    <div class="text-base font-medium text-slate-500">
                      CEO, Legacy Active Communities
                    </div>

                    <div>
                      <span
                        class="inline-flex items-center rounded-md bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800"
                        >{programme.name} Awards Winner</span
                      >
                    </div>
                  </div>
                </div>
              </footer>
            </div>
          </blockquote>
        </section>
      </div>
    </div>
    <div class="flex flex-col gap-20 mt-10">
      <div class="grid grid-cols-4 gap-20 mx-auto max-w-7xl">
        <div class="col-span-4 flex flex-col gap-10 lg:col-span-4">
          <div class="flex flex-col gap-10 lg:flex-row">
            <div class="flex flex-col basis-3/4 gap-12">
              <div class="flex flex-col gap-5">
                <div class="relative">
                  <div
                    class="absolute inset-0 flex items-center"
                    aria-hidden="true"
                  >
                    <div class="w-full border-t border-gray-300"></div>
                  </div>
                  <div class="relative flex justify-start">
                    <span
                      class="bg-white pr-3 text-3xl font-semibold leading-6 text-gray-900"
                      >Eligibility criteria</span
                    >
                  </div>
                </div>
                <div>
                  <div class="relative">
                    <div
                      class="absolute inset-0 flex items-center"
                      aria-hidden="true"
                    >
                      <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-start">
                      <span
                        class="bg-white pr-3 text-base font-semibold leading-6 text-gray-900"
                        >The entrepreneur</span
                      >
                    </div>
                  </div>
                  <div
                    class="prose lg:prose-xl"
                    set:html={marked.parse(`${programme.entrepreneur}`)}
                  />
                </div>

                <div>
                  <div class="relative">
                    <div
                      class="absolute inset-0 flex items-center"
                      aria-hidden="true"
                    >
                      <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-start">
                      <span
                        class="bg-white pr-3 text-base font-semibold leading-6 text-gray-900"
                        >The venture</span
                      >
                    </div>
                  </div>
                  <div
                    class="prose lg:prose-xl"
                    set:html={marked.parse(`${programme.venture}`)}
                  />
                </div>
              </div>

              <div class="flex flex-col gap-2">
                <div class="relative">
                  <div
                    class="absolute inset-0 flex items-center"
                    aria-hidden="true"
                  >
                    <div class="w-full border-t border-gray-300"></div>
                  </div>
                  <div class="relative flex justify-start">
                    <span
                      class="bg-white pr-3 text-3xl font-semibold leading-6 text-gray-900"
                      >Impact area</span
                    >
                  </div>
                </div>

                <div
                  class="prose lg:prose-xl"
                  set:html={marked.parse(`${programme.impact_area}`)}
                />
              </div>

              <div class="flex flex-col gap-2">
                <div class="relative">
                  <div
                    class="absolute inset-0 flex items-center"
                    aria-hidden="true"
                  >
                    <div class="w-full border-t border-gray-300"></div>
                  </div>
                  <div class="relative flex justify-start">
                    <span
                      class="bg-white pr-3 text-3xl font-semibold leading-6 text-gray-900"
                      >Programme support</span
                    >
                  </div>
                </div>
                <div
                  class="prose lg:prose-xl"
                  set:html={marked.parse(`${programme.support}`)}
                />
              </div>
            </div>
            <div class="flex flex-col basis-1/4 gap-10">
              <div class="flex flex-col gap-10">
                <!-- Article -->
                <div class="flex flex-col gap-3">
                  <h3 class="font-bold text-slate-500">Related posts</h3>
                  <article
                    class="relative isolate flex flex-col justify-end overflow-hidden rounded-2xl bg-gray-900 px-8 pb-8 pt-80 sm:pt-48 lg:pt-80"
                  >
                    <img
                      src={programme.post.image}
                      alt=""
                      class="absolute inset-0 -z-10 h-full w-full object-cover"
                    />
                    <div
                      class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"
                    >
                    </div>
                    <div
                      class="absolute inset-0 -z-10 rounded-2xl ring-1 ring-inset ring-gray-900/10"
                    >
                    </div>

                    <div
                      class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-300"
                    >
                      <!-- <time datetime="2020-03-16" class="mr-8"
                        >{programme.post.date}</time
                      > -->
                      <div class="-ml-4 flex items-center gap-x-4">
                        <svg
                          viewBox="0 0 2 2"
                          class="-ml-0.5 h-0.5 w-0.5 flex-none fill-white/50"
                        >
                          <circle cx="1" cy="1" r="1"></circle>
                        </svg>
                        <div class="flex gap-x-2.5">
                          By {programme.post.author}
                        </div>
                      </div>
                    </div>
                    <h3 class="mt-3 text-lg font-semibold leading-6 text-white">
                      <a href={programme.post.link} target="_blank">
                        <span class="absolute inset-0"></span>
                        {programme.post.title}
                      </a>
                    </h3>
                  </article>
                </div>

                <!-- Other programmes -->
                <div class="flex flex-col gap-4 lg:flex">
                  <h3 class="font-bold text-slate-500">Other programmes</h3>
                  <div class="flex flex-col gap-3">
                    {
                      programmes
                        .filter(
                          (programmei) =>
                            !(programmei.name === programme.name) &&
                            todayDate.isBefore(programmei.till) &&
                            todayDate.isAfter(programmei.from),
                        )
                        .map((programme) => (
                          <a
                            href={`/awards/${programme.slug}`}
                            class="border border-slate-100 p-6 rounded-2xl flex flex-col gap-5 hover:border-amber-300 transition"
                          >
                            <div class="flex flex-col gap-2">
                              <img
                                class="inline-block h-14 w-14 rounded-md"
                                src={`https://unltd.directus.app/assets/${programme.logo.id}`}
                                alt=""
                              />
                              <div>
                                <h3 class="text-lg font-bold">
                                  {programme.name}
                                </h3>
                                <p class="text-xs leading-relaxed">
                                  {truncate(programme.description, 100)}
                                </p>
                              </div>
                            </div>
                          </a>
                        ))
                    }
                  </div>
                </div>

                <!-- Help -->
                <div class="flex flex-col gap-3">
                  <h3 class="font-bold text-slate-500">Help</h3>
                  <div class="flex flex-col gap-3">
                    <p class="text-sm text-slate-500 leading-relaxed">
                      For social entrepreneurs with questions about grants and
                      support
                    </p>
                  </div>
                  <div class="flex flex-row gap-5">
                    <a
                      class="text-xs text-amber-700 hover:underline hover:text-amber-800"
                      href="/grants-&-support/faq">Frequently Asked Questions</a
                    >
                    <a
                      class="text-xs text-amber-700 hover:underline hover:text-amber-800"
                      href="/contact-us">Contact us</a
                    >
                  </div>
                </div>

                <!-- Inclusion -->
                <div class="flex flex-col gap-3">
                  <h3 class="font-bold text-slate-500">Inclusion</h3>
                  <div class="flex flex-col gap-3">
                    <p class="text-sm text-slate-500 leading-relaxed">
                      At least 50% of grants will go to Black, Asian,
                      marginalised ethnic groups or disabled backgrounds
                    </p>
                  </div>
                  <div class="flex flex-col gap-5">
                    <a
                      class="text-xs text-amber-700 hover:underline hover:text-amber-800"
                      href="/equity-commitments"
                      >Learn more about equity commitments</a
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </Container>
</Template>
